# model-compression-2025

Репозиторий курса по сжатию и ускорению моделей машинного обучения.
ИТМО 2025, направление магистратуры Искуственный интеллект.


*План курса*

    Пара 3 - Кластеризация весов моделей.
        1. Что такое кластеризация весов?
            - Идея: заменить уникальные веса модели на меньший набор центроидов.
            - Чем-то похоже на квантизацию, но с более сложной обработкой.
            - Сильнее сжимает, но требует дополнительной декомпрессии на инференсе.
	    2.	Как работает кластеризация?
	        - Использование k-means для группировки весов.
	        - Заменяем веса центроидами, храним индексы.
	        - Гибридный подход: кластеризация + квантизация.
	    3.	Где применяется?
	        - Чаще встречается в CV (сверточные сети, MobileNet).
	        - В NLP используется реже из-за потери точности и высокого влияния на активации.
	        - Возможные кейсы для NLP: кластеризация в self-attention блоках.
	    5.	Инструменты для кластеризации
	        - torch.nn.utils.prune + k-means.
	        - TensorFlow Model Optimization Toolkit (TFMOT).
        6. Практика
            1. Готовим окружение
	        2.	Применяем кластеризацию к весам
	            - Запускаем k-means на слоях модели.
	            - Создаём матрицу центроидов и индексов.
	        3.	Оцениваем влияние на производительность
	            - Время инференса до/после.
	            - Изменение памяти (RAM/VRAM).
	            - Насколько ухудшилось качество (accuracy, PPL).
	        4.	Сравнение с квантизацией
	            - В каких случаях кластеризация даёт лучший результат.
	            - Можно ли комбинировать методы?
	        5.	Записываем результаты в таблицу
	        6.	Домашнее задание
	            Попробовать самостоятельно реализовать кластеризацию весов для своей модели.
                Резльтаты занести в таблицу и скинуть pull request с результатами и код кластеризации в ветку занятия


### Таблица сравнения методов компрессии моделей
| Модель | Метод | Размер весов | Время инференса (CPU) | Время инференса (GPU, seconds/text) | Использование RAM (MB) | Использование VRAM (MB) | Точность 
| :---   | :----: | :----: | :----: | :----: | :----: | :----: | :----: | 
| rubert-base-cased | Оригинал | 711Mb | - | 0.029138 | - | 800Mb | 0.495 | 
| rubert-base-cased | Квантизация INT8 | 455Mb | - | 0.019614 | - | 500Mb | 0.415 | 
| rubert-base-cased | Дистилляция | 213Mb | - | 0.002773 | - | 300Mb | 0.510 | 
| rubert-base-cased | Пруннинг | 711Mb | - |  0.027385 | - | 800Mb | 0.490 | 
| rubert-base-cased | Кластеризация весов (не поддерживает) | - | - |  - | - | - | - | 

### Презентации
[Занятие 3 Кластеризация](https://docs.google.com/presentation/d/1Cjqeu4SxZuUteqSc6xaUMOePWA2H2hdpANJ5_p7kFB8/edit#slide=id.g1e7daee4ab9_0_116)
[Статья про метод кластеризации](https://arxiv.org/pdf/1510.00149)
